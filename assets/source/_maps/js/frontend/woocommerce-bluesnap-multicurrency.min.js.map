{"version":3,"file":"../../../../js/frontend/woocommerce-bluesnap-multicurrency.min.js","sources":["frontend/woocommerce-bluesnap-multicurrency.js"],"sourcesContent":["(function( $ ) {\n\t'use strict';\n\n\t// Multicurrency form submit\n\t$( '.bluesnap-multicurrency' ).on(\n\t\t'change', 'select.bluesnap_currency_selector', function() {\n\t\t\t\n\t\t\tvar $supports_html5_storage = true;\n\n\t\t\ttry {\n\t\t\t\t$supports_html5_storage = ( 'sessionStorage' in window && window.sessionStorage !== null );\n\t\t\t\twindow.sessionStorage.setItem( 'bs', 'test' );\n\t\t\t\twindow.sessionStorage.removeItem( 'bs' );\n\t\t\t\twindow.localStorage.setItem( 'bs', 'test' );\n\t\t\t\twindow.localStorage.removeItem( 'bs' );\n\t\t\t} catch( err ) {\n\t\t\t\t$supports_html5_storage = false;\n\t\t\t}\n\n\t\t\t// Clear fragments on session storage to trigger a cart refresh *before* its actually shown on the new page load with the wrong currency.\n\t\t\tif ( $supports_html5_storage && 'undefined' !== typeof( wc_cart_fragments_params ) ) {\n\t\t\t\tsessionStorage.setItem( wc_cart_fragments_params.fragment_name, '' );\n\t\t\t}\n\t\t\t\n\t\t\t$( this ).closest( 'form' ).submit();\n\t\t}\n\t);\n\n\t/**\n\t * In case there is cache on the site, and backend hooks are not represented on frontend, we have to handle the currency changes on frontend level.\n\t * @type {{cookie_name: *, init: init, get_cookie: (function(*): any), get_shown_currency_price: (function(): *), adjust_frontend: adjust_frontend}}\n\t */\n\tvar cookie_handler = {\n\t\tcookie_name: woocommerce_bluesnap_multicurrency_params.cookie_name,\n\t\tinit: function() {\n\t\t\tvar currency_cookie = this.get_cookie( this.cookie_name );\n\t\t\tvar currency_shown  = this.get_shown_currency_price();\n\t\t\tif ( currency_cookie && currency_cookie != currency_shown ) {\n\t\t\t\tthis.adjust_frontend( currency_cookie );\n\t\t\t}\n\t\t},\n\t\tget_cookie: function(name) {\n\t\t\tvar v = document.cookie.match( '(^|;) ?' + name + '=([^;]*)(;|$)' );\n\t\t\treturn v ? v[2] : null;\n\t\t},\n\t\t/**\n\t\t * Get the first price shown, and takes it currency.\n\t\t * @returns {string}\n\t\t */\n\t\tget_shown_currency_price: function() {\n\t\t\tvar first_price = $( '.currency-show' ).first();\n\t\t\treturn $( first_price ).attr( 'currency' );\n\t\t},\n\t\t/**\n\t\t * Adjust all frontend according to the real cookie value.\n\t\t * @param currency\n\t\t */\n\t\tadjust_frontend: function( currency ) {\n\t\t\t$( '.bluesnap-multicurrency-html' ).each(\n\t\t\t\tfunction(){\n\t\t\t\t\tif ( $( this ).attr( 'currency' ) == currency ) {\n\t\t\t\t\t\t$( this ).removeClass( 'currency-hide' ).addClass( 'currency-show' );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$( this ).removeClass( 'currency-show' ).addClass( 'currency-hide' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t\t$( \".bluesnap_currency_selector\" ).val( currency );\n\t\t}\n\t};\n\tcookie_handler.init();\n\n})( jQuery );\n\n//# sourceMappingURL=../../source/_maps/js/frontend/woocommerce-bluesnap-multicurrency.js.map\n"],"names":["$","on","$supports_html5_storage","window","sessionStorage","setItem","removeItem","localStorage","err","wc_cart_fragments_params","fragment_name","this","closest","submit","cookie_name","woocommerce_bluesnap_multicurrency_params","init","currency_cookie","get_cookie","currency_shown","get_shown_currency_price","adjust_frontend","name","v","document","cookie","match","first_price","first","attr","currency","each","removeClass","addClass","val","jQuery"],"mappings":"AAAA,CAAA,SAAWA,GACV,aAGAA,EAAG,yBAA0B,EAAEC,GAC9B,SAAU,oCAAqC,WAE9C,IAAIC,EAA0B,CAAA,EAE9B,IACCA,EAA4B,mBAAoBC,QAAoC,OAA1BA,OAAOC,eACjED,OAAOC,eAAeC,QAAS,KAAM,MAAO,EAC5CF,OAAOC,eAAeE,WAAY,IAAK,EACvCH,OAAOI,aAAaF,QAAS,KAAM,MAAO,EAC1CF,OAAOI,aAAaD,WAAY,IAAK,CAGtC,CAFE,MAAOE,GACRN,EAA0B,CAAA,CAC3B,CAGKA,GAA2B,aAAgB,OAAM,0BACrDE,eAAeC,QAASI,yBAAyBC,cAAe,EAAG,EAGpEV,EAAGW,IAAK,EAAEC,QAAS,MAAO,EAAEC,OAAO,CACpC,CACD,EAMqB,CACpBC,YAAaC,0CAA0CD,YACvDE,KAAM,WACL,IAAIC,EAAkBN,KAAKO,WAAYP,KAAKG,WAAY,EACpDK,EAAkBR,KAAKS,yBAAyB,EAC/CH,GAAmBA,GAAmBE,GAC1CR,KAAKU,gBAAiBJ,CAAgB,CAExC,EACAC,WAAY,SAASI,GAChBC,EAAIC,SAASC,OAAOC,MAAO,UAAYJ,EAAO,eAAgB,EAClE,OAAOC,EAAIA,EAAE,GAAK,IACnB,EAKAH,yBAA0B,WACzB,IAAIO,EAAc3B,EAAG,gBAAiB,EAAE4B,MAAM,EAC9C,OAAO5B,EAAG2B,CAAY,EAAEE,KAAM,UAAW,CAC1C,EAKAR,gBAAiB,SAAUS,GAC1B9B,EAAG,8BAA+B,EAAE+B,KACnC,WACM/B,EAAGW,IAAK,EAAEkB,KAAM,UAAW,GAAKC,EACpC9B,EAAGW,IAAK,EAAEqB,YAAa,eAAgB,EAAEC,SAAU,eAAgB,EAEnEjC,EAAGW,IAAK,EAAEqB,YAAa,eAAgB,EAAEC,SAAU,eAAgB,CAErE,CACD,EACAjC,EAAG,6BAA8B,EAAEkC,IAAKJ,CAAS,CAClD,CACD,EACed,KAAK,CAEpB,EAAGmB,MAAO"}