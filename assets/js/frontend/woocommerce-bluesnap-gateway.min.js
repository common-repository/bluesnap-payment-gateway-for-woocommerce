!function(o){"use strict";var t={AMEX:woocommerce_bluesnap_gateway_general_params.images_url+"amex.png",DINERS:woocommerce_bluesnap_gateway_general_params.images_url+"diners.png",DISCOVER:woocommerce_bluesnap_gateway_general_params.images_url+"discover.png",JCB:woocommerce_bluesnap_gateway_general_params.images_url+"jcb.png",MaestroUK:woocommerce_bluesnap_gateway_general_params.images_url+"maestro.png",MASTERCARD:woocommerce_bluesnap_gateway_general_params.images_url+"mastercard.png",VISA:woocommerce_bluesnap_gateway_general_params.images_url+"visa.png",Solo:woocommerce_bluesnap_gateway_general_params.images_url+"solo.png",CarteBleue:woocommerce_bluesnap_gateway_general_params.images_url+"cb.png",generic:woocommerce_bluesnap_gateway_general_params.generic_card_url},n={},c=e(function(){!i.is_checkout&&i.is_bluesnap_selected()&&setTimeout(function(){i.block_form()},150),o.ajax({url:woocommerce_bluesnap_gateway_general_params.wc_ajax_url.toString().replace("%%endpoint%%","bluesnap_reset_hpf"),method:"POST"}).done(function(e){woocommerce_bluesnap_gateway_general_params.token=e}).always(function(){i.credentials_requested=!1,o(document.body).trigger("update_checkout"),!i.is_checkout&&i.is_bluesnap_selected()&&i.init_bluesnap()})},100),s={onFieldEventHandler:{setupComplete:function(){i.unblock_form()},onFocus:function(e){o("[data-bluesnap='"+e+"']").removeClass("input-div-error input-div-valid")},onBlur:function(e){},onError:function(e,r,t){o("[data-bluesnap='"+e+"']").addClass("input-div-error").removeClass("input-div-valid");var a="object"==typeof woocommerce_bluesnap_gateway_general_params.errors[r];n[a?r+e:r]={tagId:e,message:a?woocommerce_bluesnap_gateway_general_params.errors[r][e]:woocommerce_bluesnap_gateway_general_params.errors[r]},-1<["400","14040","14041","14042"].indexOf(r)&&c(),_()},onType:function(e,r){r=t[r];o("#card-logo > img").attr("src",r||t.generic)},onValid:function(t){o("[data-bluesnap='"+t+"']").removeClass("input-div-error").addClass("input-div-valid"),i.get_form().find('.woocommerce-NoticeGroup-checkout[data-bluesnap-tag="'+t+'"]').remove(),o.each(n,function(e,r){r.tagId===t&&delete n[e]})}},style:{".invalid":{color:"red"},":focus":{color:"inherit"}},ccnPlaceHolder:"•••• •••• •••• ••••",cvvPlaceHolder:"CVC",expDropDownSelector:!1,"3DS":l()};function e(a,o,n){var c;return function(){var e=this,r=arguments,t=n&&!c;clearTimeout(c),c=setTimeout(function(){c=null,n||a.apply(e,r)},o),t&&a.apply(e,r)}}function r(){var e=(e=i.get_form().find(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message")).add(i.get_form().closest(".woocommerce").find(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message")),r={};return e.filter("[data-bluesnap-error]").each(function(){r[o(this).data("bluesnap-error")]=!0}),e.remove(),r}"undefined"!=typeof bluesnapStyleOverrides&&(s.style=bluesnapStyleOverrides),o(document.body).on("updated_checkout",function(e,r){var t="#bluesnap_relocalized_cart_data";i.on_bluesnap_selected("updated_checkout"),"object"==typeof r&&r.fragments&&r.fragments[t]&&woocommerce_bluesnap_gateway_general_params&&(r=JSON.parse(r.fragments[t]),woocommerce_bluesnap_gateway_general_params.total_amount=r.total,woocommerce_bluesnap_gateway_general_params.currency=r.currency)}),o(document.body).on("checkout_error",function(e,r){i.credentials_requested_type=""}),o("form#add_payment_method").on("click payment_methods",function(){i.is_bluesnap_selected()&&i.init_bluesnap()}),o("form#order_review input[type=radio][name=wc-bluesnap-payment-token]").change(function(){i.is_bluesnap_selected()&&i.init_bluesnap("order_review")});var _=e(function(){var e,t=r(),a=!1;o.each(n,function(e,r){void 0===t[e]&&(a=!0),i.get_form().prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout" data-bluesnap-error="'+e+'" data-bluesnap-tag="'+r.tagId+'"><div class="woocommerce-error">'+r.message+"</div></div>")}),i.get_form().removeClass("processing").unblock(),i.get_form().find(".input-text, select, input:checkbox").trigger("validate").blur(),a&&((e=o(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout")).length||(e=o(".form.checkout")),o.scroll_to_notices(e)),o(document.body).trigger("checkout_error")},100);var i={input_card_info_id:"#bluesnap_card_info",input_3ds_ref_id:"#bluesnap_3ds_reference_id",$checkout_form:o("form.woocommerce-checkout"),$add_payment_form:o("form#add_payment_method"),$order_review_form:o("form#order_review"),credentials_requested:!1,credentials_requested_type:"",is_checkout:!1,is_order_review_form:!1,form:null,submitted:!1,force_submit:!1,init:function(){this.$checkout_form.length&&(this.form=this.$checkout_form,this.is_checkout=!0,this.form.on("checkout_place_order",this.submit_credentials)),this.$add_payment_form.length&&(this.form=this.$add_payment_form,this.is_add_payment_method=!0,this.form.on("add_payment_method",this.submit_credentials),this.$add_payment_form.on("submit",this.add_payment_method_trigger)),this.$order_review_form.length&&(this.form=this.$order_review_form,this.is_order_review_form=!0,this.form.on("add_payment_method",this.submit_credentials),this.$order_review_form.on("submit",this.add_payment_method_trigger),i.is_bluesnap_selected())&&i.init_bluesnap(),1<o('input[name="wc-bluesnap-payment-token"]:radio').length&&this.$checkout_form.on("click",function(e){o(e.target).is('input[name="wc-bluesnap-payment-token"]:radio')&&jQuery(document.body).trigger("update_checkout")}),(this.is_add_payment_method||this.is_order_review_form)&&o(document.body).trigger("wc-credit-card-form-init"),o("body").on("click",function(e){var r,e=o(e.target);e.parents().addBack().filter(".bluesnap-cvc-tooltip-trigger").length||(r=o(".bluesnap-cvc-tooltip"),e=e.parents(r),r.not(e).removeClass("bs-tooltip-visible"))}),o("form#order_review").length&&i.on_bluesnap_selected()},is_bluesnap_selected:function(){return o("#payment_method_bluesnap").is(":checked")},is_bluesnap_ach_selected:function(){return o("#payment_method_bluesnap_ach").is(":checked")},is_bluesnap_saved_token_selected:function(){return o("#payment_method_bluesnap").is(":checked")&&o('input[name="wc-bluesnap-payment-token"]').is(":checked")&&"new"!==o('input[name="wc-bluesnap-payment-token"]:checked').val()},init_bluesnap:function(e){l()&&!i.is_bluesnap_saved_token_selected()&&"submitButton"!==o("[name='woocommerce_checkout_place_order']").attr("data-bluesnap")&&o("[name='woocommerce_checkout_place_order']").attr("data-bluesnap","submitButton"),this.credentials_requested&&"updated_checkout"!==e&&"order_review"!==e||(this.credentials_requested=!0,s.token=woocommerce_bluesnap_gateway_general_params.token,"updated_checkout"!==e&&"hpf"===this.credentials_requested_type||i.is_bluesnap_saved_token_selected()||(this.credentials_requested_type="hpf",bluesnap.hostedPaymentFieldsCreate(s)),"savedToken"!==this.credentials_requested_type&&i.is_bluesnap_saved_token_selected()&&l()&&(this.credentials_requested_type="savedToken",bluesnap.threeDsPaymentsSetup(woocommerce_bluesnap_gateway_general_params.token,function(e){1==e.code&&e.cardData&&e.threeDSecure&&e.threeDSecure.threeDSecureReferenceId?(e.threeDSecure,i.success_callback(e.cardData,e.threeDSecure.threeDSecureReferenceId)):s.onFieldEventHandler.onError.apply(s.onFieldEventHandler,["",e.code,e.info.errors[0]])}))),o(".bluesnap-cvc-tooltip-trigger").not(".bs-tooltip-initalized").on("click",function(e){e.preventDefault(),o(this).next(".bluesnap-cvc-tooltip").toggleClass("bs-tooltip-visible")})},on_bluesnap_selected:function(e){i.is_bluesnap_selected()?(i.is_bluesnap_saved_token_selected()&&o("[name='woocommerce_checkout_place_order']").removeAttr("data-bluesnap"),e=void 0!==e&&void 0!==e.type&&"change"===e.type?"updated_checkout":e,i.init_bluesnap(e)):(o("[name='payment_method']").off("change",i.on_bluesnap_selected).on("change",i.on_bluesnap_selected),o("[name='woocommerce_checkout_place_order']").removeAttr("data-bluesnap"))},secure_3d_field:function(e){var r=o("#"+e);return r.length&&o.trim(r.val()).length?r.val():void 0!==woocommerce_bluesnap_gateway_general_params[e]?woocommerce_bluesnap_gateway_general_params[e]:""},secure_3d_object:function(){var e={};if(l())switch((e={amount:parseFloat(woocommerce_bluesnap_gateway_general_params.total_amount),currency:woocommerce_bluesnap_gateway_general_params.currency,billingFirstName:i.secure_3d_field("billing_first_name"),billingLastName:i.secure_3d_field("billing_last_name"),billingCountry:i.secure_3d_field("billing_country"),billingState:"",billingCity:i.secure_3d_field("billing_city"),billingAddress:o.trim(i.secure_3d_field("billing_address_1")+" "+i.secure_3d_field("billing_address_2")),billingZip:i.secure_3d_field("billing_postcode"),email:i.secure_3d_field("billing_email")}).billingCountry){case"US":case"CA":e.billingState=i.secure_3d_field("billing_state")}return e},submit_credentials:function(e){if(!i.force_submit&&(e.preventDefault(),i.is_bluesnap_ach_selected()&&(i.is_add_payment_method||i.is_order_review_form)&&i.submit_form(),i.is_bluesnap_selected())){if(i.block_form(),r(),i.is_bluesnap_saved_token_selected()){if(woocommerce_bluesnap_gateway_general_params.stokens){e=o('input[name="wc-bluesnap-payment-token"]:radio:checked').val();if(!e)return!1;e=woocommerce_bluesnap_gateway_general_params.stokens[e];if(!e)return!1;if(!l())return i.is_order_review_form&&i.submit_form(),!0;e={last4Digits:e.last4,ccType:e.type,amount:parseFloat(woocommerce_bluesnap_gateway_general_params.total_amount),currency:woocommerce_bluesnap_gateway_general_params.currency};bluesnap.threeDsPaymentsSubmitData(e)}}else bluesnap.hostedPaymentFieldsSubmitData(function(e){if(e.cardData&&(!l()||e.threeDSecure&&e.threeDSecure.threeDSecureReferenceId)){var r="";l()&&(r=e.threeDSecure.threeDSecureReferenceId),i.success_callback(e.cardData,r)}else if(e.error){var t,a=e.error;for(t in a)s.onFieldEventHandler.onError.apply(s.onFieldEventHandler,[a[t].tagId,a[t].errorCode,a[t].errorDescription])}else i.error_callback()},i.secure_3d_object());return!(n={})}},add_payment_method_trigger:function(){if(!i.force_submit&&(i.is_bluesnap_selected()||i.is_bluesnap_ach_selected()))return i.form.trigger("add_payment_method"),!1},success_callback:function(e,r){o(this.input_card_info_id).val(JSON.stringify(e)),r=r||"",o(this.input_3ds_ref_id).val(r),i.submit_form()},error_callback:function(){i.submit_form(),i.unblock_form()},submit_form:function(){i.force_submit=!0,i.form.submit(),i.force_submit=!1},block_form:function(){i.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock_form:function(){i.form.unblock()},get_form:function(){return this.form}};function l(){return!!+woocommerce_bluesnap_gateway_general_params._3d_secure}o(function(){i.init()})}(jQuery);
//# sourceMappingURL=../../source/_maps/js/frontend/woocommerce-bluesnap-gateway.min.js.map
